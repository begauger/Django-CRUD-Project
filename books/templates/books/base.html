<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Book Review Platform{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="{% url 'home' %}">üìö Book Reviews</a>
            
            <!-- Search Bar -->
            <form class="d-flex me-3 ms-4" method="GET" action="{% url 'book_list' %}">
                <input class="form-control me-2" type="search" name="search" placeholder="Search books..." value="{{ query|default:'' }}" style="width: 250px;">
                <button class="btn btn-outline-light" type="submit">üîç</button>
            </form>
            
            <div class="navbar-nav me-auto">
                <a class="nav-link" href="{% url 'home' %}">Home</a>
                <a class="nav-link" href="{% url 'book_list' %}">All Books</a>
                {% if user.is_authenticated %}
                    <a class="nav-link" href="{% url 'add_book' %}">‚ûï Add Book</a>
                {% endif %}
            </div>
            <div class="navbar-nav d-flex align-items-center">
                {% if user.is_authenticated %}
                    <span class="navbar-text me-3">Hello, {{ user.username }}!</span>
                    {% if user.is_superuser %}
                        <a class="nav-link me-2" href="/admin/" target="_blank">‚öôÔ∏è Admin</a>
                    {% endif %}
                    <form method="post" action="{% url 'logout' %}" class="d-inline m-0">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-link nav-link border-0 p-0 text-decoration-none" style="color: rgba(255,255,255,.75); line-height: 1.5;">Logout</button>
                    </form>
                {% else %}
                    <a class="nav-link" href="/admin/" target="_blank">‚öôÔ∏è Admin</a>
                    <a class="nav-link" href="{% url 'login' %}">Login</a>
                    <a class="nav-link" href="{% url 'register' %}">Register</a>
                {% endif %}
            </div>
        </div>
    </nav>
    
    <div class="container mt-4">
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            {% endfor %}
        {% endif %}
        
        {% block content %}
        {% endblock %}
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Client-side Validation JavaScript -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Form validation for all forms
        const forms = document.querySelectorAll('form:not([method="GET"])');
        
        forms.forEach(function(form) {
            form.addEventListener('submit', function(event) {
                // Check for required fields
                const requiredFields = form.querySelectorAll('input[required], textarea[required], select[required]');
                let isValid = true;
                
                requiredFields.forEach(function(field) {
                    // Remove previous error styling
                    field.classList.remove('is-invalid');
                    
                    // Check if field is empty
                    if (!field.value.trim()) {
                        field.classList.add('is-invalid');
                        isValid = false;
                    }
                    
                    // Email validation
                    if (field.type === 'email' && field.value) {
                        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                        if (!emailRegex.test(field.value)) {
                            field.classList.add('is-invalid');
                            isValid = false;
                        }
                    }
                    
                    // ISBN validation (13 digits)
                    if (field.name === 'isbn' && field.value) {
                        const isbnRegex = /^\d{13}$/;
                        if (!isbnRegex.test(field.value.replace(/-/g, ''))) {
                            field.classList.add('is-invalid');
                            isValid = false;
                        }
                    }
                    
                    // Password confirmation
                    if (field.name === 'password2') {
                        const password1 = form.querySelector('input[name="password1"]');
                        if (password1 && field.value !== password1.value) {
                            field.classList.add('is-invalid');
                            isValid = false;
                        }
                    }
                });
                
                // Prevent form submission if invalid
                if (!isValid) {
                    event.preventDefault();
                    event.stopPropagation();
                    
                    // Show error message
                    showValidationAlert();
                }
                
                form.classList.add('was-validated');
            });
        });
        
        // Real-time validation
        document.querySelectorAll('input, textarea, select').forEach(function(field) {
            field.addEventListener('blur', function() {
                validateField(this);
            });
        });
        
        function validateField(field) {
            field.classList.remove('is-invalid', 'is-valid');
            
            if (field.hasAttribute('required') && !field.value.trim()) {
                field.classList.add('is-invalid');
            } else if (field.value.trim()) {
                field.classList.add('is-valid');
            }
        }
        
        function showValidationAlert() {
            const existingAlert = document.querySelector('.validation-alert');
            if (existingAlert) existingAlert.remove();
            
            const alert = document.createElement('div');
            alert.className = 'alert alert-danger alert-dismissible fade show validation-alert';
            alert.innerHTML = `
                <strong>‚ö†Ô∏è Validation Error!</strong> Please check the highlighted fields and try again.
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            document.querySelector('.container').insertBefore(alert, document.querySelector('.container').firstChild);
        }
    });
    </script>

</body>
</html>